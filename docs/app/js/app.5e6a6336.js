(function(t){function e(e){for(var a,r,o=e[0],l=e[1],u=e[2],d=0,m=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&m.push(s[r][0]),s[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);c&&c(e);while(m.length)m.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var l=n[o];0!==s[l]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},s={app:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var c=l;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},"512f":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-view")},i=[],r=n("2877"),o={},l=Object(r["a"])(o,s,i,!1,null,null,null),u=l.exports,c=n("8c4f"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-content",[n("v-toolbar",{attrs:{dark:!0,flat:""}},[n("v-toolbar-title",[t._v("TEI Anchor Editor")]),n("v-spacer"),n("v-btn",{attrs:{icon:""},on:{click:t.export2}},[n("v-icon",[t._v("mdi-export")])],1)],1),n("div",{style:"height: "+t.height+"px; overflow-wrap: break-word; word-break: break-all;"},[n("splitpanes",{staticClass:"default-theme"},[n("pane",{attrs:{"min-size":"20"}},[n("v-card",{staticClass:"scroll vertical pa-5",staticStyle:{"background-color":"#616161"},attrs:{id:"main"}},[n("v-card",{staticClass:"pa-5"},[t.data2?n("Hello",{attrs:{elements:t.data2.elements},on:{parentMessage:t.messageLog}}):t._e()],1)],1)],1),n("pane",[n("v-card",{staticClass:"scroll vertical pa-5",staticStyle:{"background-color":"#616161"},attrs:{id:"sub"}},[n("v-card",{staticClass:"pa-5"},[t.data?n("Hello",{attrs:{elements:t.data.elements},on:{parentMessage:t.messageLog}}):t._e()],1)],1)],1)],1)],1)],1),n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"80%"},model:{value:t.dialogFlag,callback:function(e){t.dialogFlag=e},expression:"dialogFlag"}},[n("v-card",{staticClass:"pa-5",staticStyle:{"background-color":"#616161"}},[t._l(t.dialogData.elements,(function(e,a){return["text"==e.type&&t.inputs.length>0?[n("v-card",{key:a,staticClass:"mb-5"},[n("v-container",{staticClass:"pa-10"},[n("h3",[t._v(t._s(e.text))]),n("v-row",{staticClass:"mt-5"},[n("v-col",{attrs:{cols:"12",md:"12"}},[n("v-textarea",{attrs:{filled:"",rows:"1",label:"アンカーの挿入箇所より前のテキスト部分を入力してください。",hint:"ex. "+e.text.substring(0,e.text.length/2)},model:{value:t.inputs[a].text,callback:function(e){t.$set(t.inputs[a],"text",e)},expression:"inputs[index].text"}})],1)],1),n("v-row",[n("v-col",{attrs:{cols:"12",md:"12"}},[n("v-text-field",{attrs:{label:"挿入対象テキストのIDを入力してください。",filled:"",hint:"ex. "+(t.inputs[a].id?t.inputs[a].id:"http://example.org/id/123")},model:{value:t.inputs[a].id,callback:function(e){t.$set(t.inputs[a],"id",e)},expression:"inputs[index].id"}})],1)],1),n("v-row",[n("v-col",{attrs:{cols:"12",md:"12"}},[n("v-btn",{attrs:{block:"",color:"primary","x-large":""},on:{click:function(e){return t.add(a)}}},[t._v(" 登録 ")])],1)],1)],1)],1)]:t._e()]})),n("v-card",{staticClass:"mt-10 mb-5"},[n("v-container",{staticClass:"pa-10"},[n("h3",[t._v("Optional: JSON Editor")]),n("v-jsoneditor",{staticClass:"my-5",attrs:{options:t.options,plus:!0,height:"600px"},on:{error:t.onError},model:{value:t.json,callback:function(e){t.json=e},expression:"json"}}),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary darken-1"},on:{click:function(e){return t.updateDialogData()}}},[t._v("更新")]),n("v-btn",{attrs:{color:"warning darken-1",text:""},on:{click:function(e){return t.$store.dispatch("setDialogFlag",!1)}}},[t._v("閉じる")])],1)],1)],1)],2)],1)],1),n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"80%"},model:{value:t.resultFlag,callback:function(e){t.resultFlag=e},expression:"resultFlag"}},[n("v-card",{staticClass:"pa-5"},[n("h3",{staticClass:"my-5"},[t._v("出力結果")]),n("v-textarea",{attrs:{solo:"",value:t.result,rows:"20"}})],1)],1)],1)],1)},m=[],p=(n("fb6a"),n("a434"),n("a9e3"),n("ac1f"),n("5319"),n("841c"),n("1276"),n("4c53"),n("512e")),g=n("bc3a"),f=n.n(g),h=n("27f7"),v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[t._l(t.elements,(function(e,a){return[e.text?[n("span",{key:a},[t._v(t._s(e.text))])]:"p"==e.name||"head"==e.name||"ab"==e.name||"list"==e.name||"listPerson"==e.name||"item"==e.name||"person"==e.name?[n("span",{key:a,staticClass:"my-5",class:"tei-"+e.name},[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)]:"date"==e.name?[n("v-tooltip",{key:a,attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var i=s.on;return[n("span",t._g({style:t.style(e.name)},i),[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]}}],null,!0)},[n("span",[t._v(t._s(e.attributes))])])]:"teiHeader"==e.name?void 0:"title"==e.name?[n("h2",{key:a,staticClass:"my-5"},[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)]:"eaj:ruby"==e.name||e.attributes&&"ruby"==e.attributes.type?[n("ruby",{key:a},[n("Hello",{attrs:{elements:e.elements[0].elements}}),n("rt",[t._v(t._s(e.elements[2].elements[0].text))])],1)]:"persName"==e.name||"placeName"==e.name||"name"==e.name||"rs"==e.name||"speaker"==e.name||"bibl"==e.name?[n("v-tooltip",{key:a,attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var i=s.on;return[n("span",t._g({key:a,class:"tei-"+e.name,style:"person"!=t.parent&&"respStmt"!=t.parent?t.style(e.name):"margin-right : 10px; margin-left : 10px;",attrs:{id:e.id},on:{click:function(n){"person"!=t.parent&&"respStmt"!=t.parent&&t.$emit("parentMessage",e)}}},e.attributes?i:null),[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)]}}],null,!0)},[n("span",[t._v(t._s(e.attributes))])])]:"seg"==e.name&&e.attributes&&e.attributes.rendition?[n("span",{key:a,class:"tei-"+e.attributes.rendition,style:e.attributes.style},[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)]:"anchor"==e.name?[n("span",{key:a,style:e.attributes["corresp"].split("#")[1]===t.lineId?"background-color : rgba(255,165,0, 0.5);":"",on:{mouseover:function(n){t.mouseover(e.attributes["corresp"].split("#")[1])}}},[n("v-icon",{attrs:{color:"blue darken-2"}},[t._v("mdi-anchor")])],1)]:"seg"==e.name&&e.attributes.corresp?[n("span",{key:a},[n("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(a){var s=a.on;return[n("v-btn",t._g({staticClass:"mb-5",attrs:{icon:"",color:"primary",dark:""},on:{click:function(n){return t.idClick(e)}}},s),[n("v-icon",[t._v("mdi-tooltip-edit")])],1)]}}],null,!0)},[t._v(" "+t._s(e.attributes.corresp)+" ")]),n("span",{class:"tei-"+e.name,on:{click:function(n){return t.anchorClick(e)}}},[e.attributes&&e.attributes.facs&&e.attributes.facs.startsWith("#")?n("span",{on:{click:function(n){return t.$emit("parentMessage",e)}}},[n("img",{staticClass:"mr-2",staticStyle:{width:"30px"},attrs:{src:"https://iiif.dl.itc.u-tokyo.ac.jp/images/iiif.png"}})]):t._e(),e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)],1)]:"s"==e.name?[n("div"==t.childDiv(e)?"div":"span",{key:a,tag:"component",style:e.attributes["xml:id"]===t.lineId?"background-color : rgba(255,165,0, 0.5);":"",on:{mouseover:function(n){return t.mouseover(e.attributes["xml:id"])},click:function(n){return t.selectSub(e.attributes["xml:id"])}}},[n("span",{staticStyle:{color:"#1976D2"},style:e.attributes["xml:id"]===t.subLineId?"color : #ff5252;":""},[t._v(t._s(e.attributes["xml:id"]))]),n("span",{class:"tei-"+e.name},[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)])]:"figure"!=e.name?[n("span",{key:a,class:"tei-"+e.name},[e.elements?n("Hello",{key:a,attrs:{elements:e.elements,parent:e.name},on:{parentMessage:t.messageLog}}):t._e()],1)]:t._e()]}))],2)},b=[],_=n("f029"),y={name:"Hello",props:["elements","flg","parent"],data:function(){return{highlight_line:"",sharedState:this.$store.getters}},computed:{lineId:{get:function(){return this.$store.getters.lineId}},subLineId:{get:function(){return this.$store.getters.subLineId}}},mounted:function(){this.init()},methods:{init:function(){var t=this.elements;if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];n.id=_["a"].v1()}},messageLog:function(t){this.$emit("parentMessage",t)},mouseover:function(t){this.highlight_line=t,this.$store.dispatch("setLineId",t)},selectSub:function(t){this.$store.dispatch("setSubLineId",t)},idClick:function(t){this.$store.dispatch("setDialogFlag",!0),this.$store.dispatch("setDialogData",t)},anchorClick:function(){console.log("scroll !!!")},childDiv:function(t){return t.elements[0].attributes?"div"==t.elements[0].attributes.rendition?"div":"span":null}}},x=y,k=n("6544"),w=n.n(k),S=n("8336"),D=n("132d"),I=n("3a2f"),L=Object(r["a"])(x,v,b,!1,null,null,null),j=L.exports;w()(L,{VBtn:S["a"],VIcon:D["a"],VTooltip:I["a"]});var C=n("c51a"),$=n("1c46");function F(t){var e=$.createHash("md5");return e.update(t,"binary").digest("hex")}var M={components:{Splitpanes:p["Splitpanes"],Pane:p["Pane"],Hello:j,VJsoneditor:h["a"]},data:function(){return{e:null,data:null,data2:null,width:window.innerWidth,height:window.innerHeight,return_url:null,return_label:null,dialog_information:!1,dialog_settings:!1,url_main:"",url_sub:"",test:"",data_main:[],data_sub:[],data_main_e:[],data_sub_e:[],hightlights:[],m_s_id_map:[],s_m_id_map:[],w_l_id_map:{},l_w_id_map:{},image_map:{},label_main:"",label_sub:"",selected_manifests:[],mirador_path:"",direction:"vertical",layout:"2x2",json:[],inputs:[],options:{mode:"code"},result:{},resultFlag:!1}},computed:{subLineId:{get:function(){return this.$store.getters.subLineId},set:function(t){this.$store.dispatch("setSubLineId",t)}},dialogFlag:{get:function(){return this.$store.getters.dialogFlag},set:function(t){this.$store.dispatch("setDialogFlag",t)}},dialogData:{get:function(){return this.$store.getters.dialogData},set:function(t){this.$store.dispatch("setDialogData",t)}}},mounted:function(){window.addEventListener("resize",this.handleResize),null==this.$route.query.u&&"localhost"!=location.hostname&&(location.href="https://github.com/TEI-EAJ/parallel_text_viewer/");var t=this.$route.query.main?this.$route.query.main:"https://webpark5032.sakura.ne.jp/tmp/genji/01_main.xml",e=this.$route.query.sub?this.$route.query.sub:"https://webpark5032.sakura.ne.jp/tmp/genji/01.xml";this.url_sub=e,this.exec2main(t),this.exec2sub(e)},watch:{$route:function(){this.search()},dialogData:function(t){if(this.json=t.elements,this.inputs=[],this.json)for(var e=0;e<this.json.length;e++)this.inputs.push({text:"",id:this.subLineId?this.subLineId:""})}},methods:{messageLog:function(t){this.e=t;var e=Number(t.attributes.n),n="https://w3id.org/kouigenjimonogatari/data/0"+("0000000000"+e).slice(-3)+"-01.json",a=this.convert_uri(n);this.clickIcon(a)},clickIcon:function(t){for(var e=this.selected_manifests,n=[],a=0;a<e.length;a++){var s=e[a];if(s.selected){var i=s.label,r=this.image_map[i].data;if(r[t]){var o=r[t],l=o.split("#xywh="),u=l[0],c=l[1].split(","),d=Number(c[1])-150,m=Number(c[3])+150;o=u+"#xywh="+c[0]+","+d+","+c[2]+","+m,n.push({manifest:this.image_map[i].manifest,canvas:o})}}}},scroll:function(t){var e=[],n="";if(this.m_s_id_map[this.w_l_id_map[t]]?(e=this.m_s_id_map[this.w_l_id_map[t]],n="sub"):this.l_w_id_map[this.s_m_id_map[t][0]]&&(e=this.l_w_id_map[this.s_m_id_map[t][0]],n="main"),e.length>0){var a=e[0];"vertical"==this.direction?this.$SmoothScroll(document.querySelector("#"+a).getBoundingClientRect().left+document.querySelector("#"+n).scrollLeft-document.querySelector("#"+n).getBoundingClientRect().left-document.querySelector("#"+n).getBoundingClientRect().width/2+document.querySelector("#"+a).getBoundingClientRect().width,.1,null,document.querySelector("#"+n),"x"):this.$SmoothScroll(document.querySelector("#"+a).getBoundingClientRect().top+document.querySelector("#"+n).scrollTop-document.querySelector("#"+n).getBoundingClientRect().top,.1,null,document.querySelector("#"+n),"y")}},handleResize:function(){this.width=window.innerWidth,this.height=window.innerHeight},exec2main:function(t){var e=this;f.a.get(t,{}).then((function(t){var n=t.data;if("string"==typeof n){var a=new DOMParser;n=a.parseFromString(n,"text/xml")}var s=(new XMLSerializer).serializeToString(n),i=C.xml2json(s,{compact:!1,spaces:4});e.data2=JSON.parse(i)}))},exec2sub:function(t){var e=this;f.a.get(t,{}).then((function(t){var n=t.data;if("string"==typeof n){var a=new DOMParser;n=a.parseFromString(n,"text/xml")}e.xml=n;var s=(new XMLSerializer).serializeToString(n),i=C.xml2json(s,{compact:!1,spaces:4});e.data=JSON.parse(i)}))},convert_uri:function(t){var e=t.split("#");return 2!=e.length?"id-"+F(t):"id-"+F(e[0])+"#"+e[1]},updateDialogData:function(){var t=Object.create(this.dialogData);t.elements=this.json,this.dialogData=t,this.dialogFlag=!1,this.inputs=[]},add:function(t){var e=this.inputs[t],n=this.dialogData.elements,a=this.dialogData.elements[t].text,s=[e.text,a.replace(e.text,"")];n.splice(t,1),n.splice(t,0,{text:s[0],type:"text"}),n.splice(t+1,0,{name:"anchor",type:"element",attributes:{corresp:this.url_sub+"#"+e.id}}),n.splice(t+2,0,{text:s[1],type:"text"}),this.dialogFlag=!1,this.inputs=[],this.dialogData.elements=n},export2:function(){var t={compact:!1,ignoreComment:!0,spaces:4},e=C.json2xml(this.data2,t);this.result=e,this.resultFlag=!0},onError:function(){}},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)}},O=M,V=(n("8fc1"),n("7496")),H=n("b0af"),J=n("99d9"),q=n("62ad"),T=n("a523"),E=n("a75b"),P=n("169a"),z=n("0fd9"),R=n("2fa4"),B=n("8654"),N=n("a844"),A=n("71d9"),W=n("2a7f"),X=Object(r["a"])(O,d,m,!1,null,null,null),U=X.exports;w()(X,{VApp:V["a"],VBtn:S["a"],VCard:H["a"],VCardActions:J["a"],VCol:q["a"],VContainer:T["a"],VContent:E["a"],VDialog:P["a"],VIcon:D["a"],VRow:z["a"],VSpacer:R["a"],VTextField:B["a"],VTextarea:N["a"],VToolbar:A["a"],VToolbarTitle:W["a"]}),a["a"].use(c["a"]);var G=[{path:"/",name:"index",component:U}],K=new c["a"]({base:"",routes:G,scrollBehavior:function(){return{x:0,y:0}}}),Q=K,Y=n("f309");a["a"].use(Y["a"]);var Z=new Y["a"]({}),tt=n("c4e8"),et=n.n(tt),nt=n("2f62");a["a"].use(nt["a"]);var at=new nt["a"].Store({debug:!0,state:{message:"初期メッセージ",lineId:null,subLineId:null,dialogFlag:!1,dialogData:{},fullJson:{}},getters:{message:function(t){return t.message},lineId:function(t){return t.lineId},subLineId:function(t){return t.subLineId},dialogFlag:function(t){return t.dialogFlag},dialogData:function(t){return t.dialogData},fullJson:function(t){return t.fullJson}},mutations:{setMessage:function(t,e){t.message=e.message},setLineId:function(t,e){t.lineId=e.lineId},setSubLineId:function(t,e){t.subLineId=e.subLineId},setDialogFlag:function(t,e){t.dialogFlag=e.dialogFlag},setDialogData:function(t,e){t.dialogData=e.dialogData},setFullJson:function(t,e){t.fullJson=e.fullJson}},actions:{doUpdate:function(t,e){var n=t.commit;n("setMessage",{payload:e})},setLineId:function(t,e){var n=t.commit;n("setLineId",{lineId:e})},setSubLineId:function(t,e){var n=t.commit;n("setSubLineId",{subLineId:e})},setDialogFlag:function(t,e){var n=t.commit;n("setDialogFlag",{dialogFlag:e})},setDialogData:function(t,e){var n=t.commit;n("setDialogData",{dialogData:e})},setFullJson:function(t,e){var n=t.commit;n("seFullJson",{fullJson:e})}}}),st=at;a["a"].use(et.a),a["a"].config.productionTip=!1,new a["a"]({store:st,router:Q,vuetify:Z,render:function(t){return t(u)}}).$mount("#app")},"8fc1":function(t,e,n){"use strict";var a=n("512f"),s=n.n(a);s.a}});
//# sourceMappingURL=app.5e6a6336.js.map